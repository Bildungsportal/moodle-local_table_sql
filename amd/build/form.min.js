define("local_table_sql/form",["exports","jquery","core/modal_factory","core/modal_events","core/notification"],(function(_exports,_jquery,_modal_factory,_modal_events,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.loadModal=async function(sender){let modaldata=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const $pane=(0,_jquery.default)(sender).closest(".table-sql-modal");modaldata=modaldata||$pane.data("modaldata");const xhrdata={...modaldata.xhrdata,is_xhr:1,table_sql_action:"form_show"};false;var response=await xhrRequest(xhrdata);_modal_factory.default.create({body:"",large:!0,removeOnClose:!0,title:response.modal_title,type:_modal_factory.default.types.SAVE_CANCEL}).then((function(modal){updateModal(modaldata,modal,response,$pane),modal.show(),modal.getRoot().on(_modal_events.default.save,(e=>{e.preventDefault(),send(modaldata,modal,$pane)}))}))},_jquery=_interopRequireDefault(_jquery),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification);async function xhrRequest(xhrdata){try{return await _jquery.default.post(document.location.href,xhrdata)}catch(e){var error="";throw e.responseText&&"string"==typeof e.responseText&&"<"===e.responseText[0]&&(error=(0,_jquery.default)(e.responseText).find(".errormessage").text()),error||(error="Unknown error!"),_notification.default.exception(new Error(error)),e}}function updateModal(modaldata,modal,response,$pane){(0,_jquery.default)(modal.getRoot()).find(".modal-body").html(response.form);for(const[key,value]of Object.entries(modaldata.values||[]))(0,_jquery.default)(modal.getRoot()).find('input[type="text"], select, textarea').filter('[name="'+key+'"], select[name="'+key+'"]').val(value),(0,_jquery.default)(modal.getRoot()).find('radio[name="'+key+'"][value="'+value+'"').prop("checked",!0);let showfields=modaldata.showfields,$form=(0,_jquery.default)(modal.getRoot()).find("form");if(showfields&&showfields.length>0&&$form.find("[name]").each((function(){let name=(0,_jquery.default)(this).attr("name");-1===showfields.indexOf(name)&&(0,_jquery.default)(this).closest(".row").not(".has-danger").addClass("hidden")})),$form.find("#id_submitbutton").closest(".row").remove(),$form.append('<input type="submit"  class="hidden"/>'),$form.submit((function(e){e.preventDefault(),modal.getRoot().trigger(_modal_events.default.save)})),response.pageendcode){let script=(0,_jquery.default)("<script>").data("added",Date.now()).html(response.pageendcode);false,(0,_jquery.default)("body").append(script)}}async function send(modaldata,modal,$pane){let form=(0,_jquery.default)(modal.getRoot()).find("form");const xhrdata={...modaldata.xhrdata,...(0,_jquery.default)(form).serializeArray().reduce((function(obj,item){return item.name.match(/\[\]$/)?(obj[item.name]||(obj[item.name]=[]),obj[item.name].push(item.value)):obj[item.name]=item.value,obj}),{}),is_xhr:1,table_sql_action:"form_save"};var response=await xhrRequest(xhrdata);response.form?updateModal(modaldata,modal,response):((0,_jquery.default)(modal.getRoot()).find(".modal-body").html(""),$pane.length&&response.colreplace?$pane.replaceWith((0,_jquery.default)(response.colreplace)):window.table_sql_reload(),modal.hide())}}));

//# sourceMappingURL=form.min.js.map